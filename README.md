# Barter App

Приложение для обмена товарами между пользователями. Пользователи могут создавать объявления о товарах, которые они хотят обменять, просматривать объявления других пользователей и предлагать обмен.

## Содержание

- [Требования](#требования)
- [Установка](#установка)
  - [Локальная установка с Poetry](#локальная-установка-с-poetry)
  - [Установка с Docker](#установка-с-docker)
- [Конфигурация](#конфигурация)
- [Запуск сервера](#запуск-сервера)
- [Запуск тестов](#запуск-тестов)
- [Структура проекта](#структура-проекта)

## Требования

- Python 3.12+
- PostgreSQL 16
- Poetry 1.8.2+
- Docker и Docker Compose (опционально)

## Установка

### Локальная установка с Poetry

1. **Клонирование репозитория**

   ```bash
   git clone https://github.com/baevtimofey/eff-modile-barter-test-task.git
   cd eff-modile-barter-test-task
   ```

2. **Установка зависимостей с Poetry**

   ```bash
   poetry install
   ```

3. **Создание и активация виртуального окружения**

   ```bash
   poetry shell
   ```

4. **Создание .env файла**

   Создайте файл `.env` в корне проекта на основе `.env.example`:

   ```bash
   cp .env.example .env
   ```

   Отредактируйте файл `.env` и укажите необходимые параметры.

5. **Применение миграций**

   ```bash
   make migrate
   ```

6. **Создание суперпользователя**

   ```bash
   python manage.py createsuperuser
   ```

### Установка с Docker

1. **Клонирование репозитория**

   ```bash
   git clone https://github.com/baevtimofey/eff-modile-barter-test-task.git
   cd eff-modile-barter-test-task
   ```

2. **Настройка .env файла**

   Создайте файл `.env` в корне проекта на основе `.env.example`:

   ```bash
   cp .env.example .env
   ```

   Отредактируйте файл `.env` и укажите необходимые параметры.


3. **Запуск контейнеров**

   ```bash
   docker compose up --build
   ```

   Это соберет и запустит приложение и базу данных. Первый запуск может занять некоторое время.

4. **Очистка данных** (если необходимо)

   Для полной очистки данных (включая базу данных, медиа и статические файлы):

   ```bash
   docker compose down -v
   ```

## Конфигурация

### Переменные окружения

Основные переменные окружения, используемые в проекте:

| Переменная         | Описание                             | Значение по умолчанию |
|--------------------|--------------------------------------|---------------------- |
| SECRET_KEY         | Секретный ключ Django                | -                     |
| DEBUG              | Режим отладки                        | -                     |
| DB_NAME            | Имя базы данных                      | -                     |
| DB_USER            | Пользователь базы данных             | -                     |
| DB_PASSWORD        | Пароль пользователя БД               | -                     |
| DB_HOST            | Хост базы данных                     | db (в Docker)         |
| DB_PORT            | Порт базы данных                     | -                     |
| ADMIN_USERNAME     | Имя пользователя администратора      | -                     |
| ADMIN_EMAIL        | Email администратора                 | -                     |
| ADMIN_PASSWORD     | Пароль администратора                | -                     |

## Запуск сервера

### Локальный запуск

```bash
make run
```

Сервер будет доступен по адресу http://127.0.0.1:8000/

### Запуск в Docker

```bash
docker compose up
```

Сервер будет доступен по адресу http://localhost:8000/

## Запуск тестов

### Локальный запуск тестов

```bash
make test
```

Эта команда автоматически запустит все тесты с помощью pytest.

### Запуск тестов в Docker

```bash
docker compose run --rm web make test
```

## Структура проекта

- `barter_project/` - основные настройки Django проекта
- `barter_app/` - основное приложение с моделями, представлениями и формами
- `tests/` - тесты проекта
  - `unit/` - модульные тесты
  - `integration/` - интеграционные тесты
- `media/` - загруженные пользователями файлы
- `static/` - статические файлы (CSS, JavaScript и т.д.)
- `docker-compose.yml` - конфигурация Docker Compose
- `Dockerfile` - инструкции для сборки Docker-образа
- `pyproject.toml` - конфигурация Poetry и зависимости проекта
